document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector('a[href*="security.logs.export"]');e&&e.addEventListener("click",function(s){s.preventDefault();const o=e.innerHTML;e.innerHTML='<i class="ri-loader-4-line me-1 animate-spin"></i>جاري التصدير...',e.classList.add("disabled"),fetch(e.href).then(n=>n.json()).then(n=>{const d=function(i){if(!i||!i.length)return"";const c=Object.keys(i[0]);return["\uFEFF"+c.join(","),...i.map(u=>c.map(f=>{let t=u[f]||"";return t=t.toString().replace(/"/g,'""'),(t.includes(",")||t.includes(`
`))&&(t=`"${t}"`),t}).join(","))].join(`
`)}(n),l=new Blob([d],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),a=URL.createObjectURL(l);r.setAttribute("href",a),r.setAttribute("download",`security-logs-${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(r),r.click(),document.body.removeChild(r),e.innerHTML=o,e.classList.remove("disabled")}).catch(n=>{console.error("Error exporting logs:",n),e.innerHTML=o,e.classList.remove("disabled"),alert("حدث خطأ أثناء تصدير السجلات. يرجى المحاولة مرة أخرى.")})})});
