(async function(){let g;const s=document.querySelector(".kanban-update-item-sidebar"),f=document.querySelector(".kanban-wrapper"),w=document.querySelector(".comment-editor"),u=document.querySelector(".kanban-add-new-board"),p=[].slice.call(document.querySelectorAll(".kanban-add-board-input")),k=document.querySelector(".kanban-add-board-btn"),h=document.querySelector("#due-date"),b=$(".select2"),v=document.querySelector("html").getAttribute("data-assets-path"),T=new bootstrap.Offcanvas(s),A=await fetch(v+"json/kanban.json");if(A.ok,g=await A.json(),h&&h.flatpickr({monthSelectorType:"static",altInput:!0,altFormat:"j F, Y",dateFormat:"Y-m-d"}),b.length){let t=function(e){return e.id?"<div class='badge "+$(e.element).data("color")+"'> "+e.text+"</div>":e.text};var H=t;b.each(function(){var e=$(this);e.wrap("<div class='position-relative'></div>").select2({placeholder:"Select Label",dropdownParent:e.parent(),templateResult:t,templateSelection:t,escapeMarkup:function(a){return a}})})}function y(t,e,a,n,d){var i=e?" pull-up":"",o="avatar-"+a,r=d==null?" ":d.split(",");return t==null?" ":t.split(",").map(function(c,C,D){var M=n&&C!==D.length-1?" me-"+n:"";return"<div class='avatar "+o+M+"'data-bs-toggle='tooltip' data-bs-placement='top'title='"+r[C]+"'><img src='"+v+"img/avatars/"+c+"' alt='Avatar' class='rounded-circle "+i+"'></div>"}).join(" ")}w&&new Quill(w,{modules:{toolbar:".comment-toolbar"},placeholder:"Write a Comment... ",theme:"snow"});const l=new jKanban({element:".kanban-wrapper",gutter:"12px",widthBoard:"250px",dragItems:!0,boards:g,dragBoards:!0,addItemButton:!0,buttonContent:"+ Add Item",itemAddOptions:{enabled:!0,content:"+ Add New Item",class:"kanban-title-button btn",footer:!1},click:function(t){let e=t,a=e.getAttribute("data-eid")?e.querySelector(".kanban-text").textContent:e.textContent,n=e.getAttribute("data-due-date"),d=new Date,i=d.getFullYear(),o=n?n+", "+i:d.getDate()+" "+d.toLocaleString("en",{month:"long"})+", "+i,r=e.getAttribute("data-badge-text"),c=e.getAttribute("data-assigned");T.show(),s.querySelector("#title").value=a,s.querySelector("#due-date").nextSibling.value=o,$(".kanban-update-item-sidebar").find(b).val(r).trigger("change"),s.querySelector(".assigned").innerHTML="",s.querySelector(".assigned").insertAdjacentHTML("afterbegin",y(c,!1,"xs","1",t.getAttribute("data-members"))+"<div class='avatar avatar-xs ms-1'><span class='avatar-initial rounded-circle bg-label-secondary'><i class='ti ti-plus ti-xs text-heading'></i></span></div>")},buttonClick:function(t,e){const a=document.createElement("form");a.setAttribute("class","new-item-form"),a.innerHTML='<div class="mb-4"><textarea class="form-control add-new-item" rows="2" placeholder="Add Content" autofocus required></textarea></div><div class="mb-4"><button type="submit" class="btn btn-primary btn-sm me-4 waves-effect waves-light">Add</button><button type="button" class="btn btn-label-secondary btn-sm cancel-add-item waves-effect waves-light">Cancel</button></div>',l.addForm(e,a),a.addEventListener("submit",function(n){n.preventDefault();const d=[].slice.call(document.querySelectorAll(".kanban-board[data-id="+e+"] .kanban-item"));l.addElement(e,{title:"<span class='kanban-text'>"+n.target[0].value+"</span>",id:e+"-"+d.length+1}),[].slice.call(document.querySelectorAll(".kanban-board[data-id="+e+"] .kanban-text")).forEach(function(o){o.insertAdjacentHTML("beforebegin","<div class='dropdown kanban-tasks-item-dropdown'><i class='dropdown-toggle ti ti-dots-vertical' id='kanban-tasks-item-dropdown' data-bs-toggle='dropdown' aria-haspopup='true' aria-expanded='false'></i><div class='dropdown-menu dropdown-menu-end' aria-labelledby='kanban-tasks-item-dropdown'><a class='dropdown-item' href='javascript:void(0)'>Copy task link</a><a class='dropdown-item' href='javascript:void(0)'>Duplicate task</a><a class='dropdown-item delete-task' href='javascript:void(0)'>Delete</a></div></div>")});const i=[].slice.call(document.querySelectorAll(".kanban-item .kanban-tasks-item-dropdown"));i&&i.forEach(function(o){o.addEventListener("click",function(r){r.stopPropagation()})}),[].slice.call(document.querySelectorAll(".kanban-board[data-id="+e+"] .delete-task")).forEach(function(o){o.addEventListener("click",function(){const r=this.closest(".kanban-item").getAttribute("data-eid");l.removeElement(r)})}),a.remove()}),a.querySelector(".cancel-add-item").addEventListener("click",function(n){a.remove()})}});f&&new PerfectScrollbar(f);const m=document.querySelector(".kanban-container"),x=[].slice.call(document.querySelectorAll(".kanban-title-board")),S=[].slice.call(document.querySelectorAll(".kanban-item"));S&&S.forEach(function(t){const e="<span class='kanban-text'>"+t.textContent+"</span>";let a="";var n,d,i,o,r,c;t.getAttribute("data-image")!==null&&(a="<img class='img-fluid rounded mb-2' src='"+v+"img/elements/"+t.getAttribute("data-image")+"'>"),t.textContent="",t.getAttribute("data-badge")!==void 0&&t.getAttribute("data-badge-text")!==void 0&&t.insertAdjacentHTML("afterbegin",(n=t.getAttribute("data-badge"),d=t.getAttribute("data-badge-text"),"<div class='d-flex justify-content-between flex-wrap align-items-center mb-2'><div class='item-badges'> <div class='badge bg-label-"+n+"'> "+d+"</div></div><div class='dropdown kanban-tasks-item-dropdown'><i class='dropdown-toggle ti ti-dots-vertical' id='kanban-tasks-item-dropdown' data-bs-toggle='dropdown' aria-haspopup='true' aria-expanded='false'></i><div class='dropdown-menu dropdown-menu-end' aria-labelledby='kanban-tasks-item-dropdown'><a class='dropdown-item' href='javascript:void(0)'>Copy task link</a><a class='dropdown-item' href='javascript:void(0)'>Duplicate task</a><a class='dropdown-item delete-task' href='javascript:void(0)'>Delete</a></div></div></div>"+a+e)),t.getAttribute("data-comments")===void 0&&t.getAttribute("data-due-date")===void 0&&t.getAttribute("data-assigned")===void 0||t.insertAdjacentHTML("beforeend",(i=t.getAttribute("data-attachments"),o=t.getAttribute("data-comments"),r=t.getAttribute("data-assigned"),c=t.getAttribute("data-members"),"<div class='d-flex justify-content-between align-items-center flex-wrap mt-2'><div class='d-flex'> <span class='d-flex align-items-center me-2'><i class='ti ti-paperclip me-1'></i><span class='attachments'>"+i+"</span></span> <span class='d-flex align-items-center ms-2'><i class='ti ti-message-2 me-1'></i><span> "+o+" </span></span></div><div class='avatar-group d-flex align-items-center assigned-avatar'>"+y(r,!0,"xs",null,c)+"</div></div>"))}),[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(t){return new bootstrap.Tooltip(t)});const q=[].slice.call(document.querySelectorAll(".kanban-tasks-item-dropdown"));q&&q.forEach(function(t){t.addEventListener("click",function(e){e.stopPropagation()})}),k&&k.addEventListener("click",()=>{p.forEach(t=>{t.value="",t.classList.toggle("d-none")})}),m&&m.appendChild(u),x&&x.forEach(function(t){t.addEventListener("mouseenter",function(){this.contentEditable="true"}),t.insertAdjacentHTML("afterend","<div class='dropdown'><i class='dropdown-toggle ti ti-dots-vertical cursor-pointer' id='board-dropdown' data-bs-toggle='dropdown' aria-haspopup='true' aria-expanded='false'></i><div class='dropdown-menu dropdown-menu-end' aria-labelledby='board-dropdown'><a class='dropdown-item delete-board' href='javascript:void(0)'> <i class='ti ti-trash ti-xs' me-1></i> <span class='align-middle'>Delete</span></a><a class='dropdown-item' href='javascript:void(0)'><i class='ti ti-edit ti-xs' me-1></i> <span class='align-middle'>Rename</span></a><a class='dropdown-item' href='javascript:void(0)'><i class='ti ti-archive ti-xs' me-1></i> <span class='align-middle'>Archive</span></a></div></div>")});const E=[].slice.call(document.querySelectorAll(".delete-board"));E&&E.forEach(function(t){t.addEventListener("click",function(){const e=this.closest(".kanban-board").getAttribute("data-id");l.removeBoard(e)})});const L=[].slice.call(document.querySelectorAll(".delete-task"));L&&L.forEach(function(t){t.addEventListener("click",function(){const e=this.closest(".kanban-item").getAttribute("data-eid");l.removeElement(e)})});const j=document.querySelector(".kanban-add-board-cancel-btn");j&&j.addEventListener("click",function(){p.forEach(t=>{t.classList.toggle("d-none")})}),u&&u.addEventListener("submit",function(t){t.preventDefault();const e=this.querySelector(".form-control").value,a=e.replace(/\s+/g,"-").toLowerCase();l.addBoards([{id:a,title:e}]);const n=document.querySelectorAll(".kanban-board:last-child")[0];n&&(n.querySelector(".kanban-title-board").insertAdjacentHTML("afterend","<div class='dropdown'><i class='dropdown-toggle ti ti-dots-vertical cursor-pointer' id='board-dropdown' data-bs-toggle='dropdown' aria-haspopup='true' aria-expanded='false'></i><div class='dropdown-menu dropdown-menu-end' aria-labelledby='board-dropdown'><a class='dropdown-item delete-board' href='javascript:void(0)'> <i class='ti ti-trash ti-xs' me-1></i> <span class='align-middle'>Delete</span></a><a class='dropdown-item' href='javascript:void(0)'><i class='ti ti-edit ti-xs' me-1></i> <span class='align-middle'>Rename</span></a><a class='dropdown-item' href='javascript:void(0)'><i class='ti ti-archive ti-xs' me-1></i> <span class='align-middle'>Archive</span></a></div></div>"),n.querySelector(".kanban-title-board").addEventListener("mouseenter",function(){this.contentEditable="true"}));const d=n.querySelector(".delete-board");d&&d.addEventListener("click",function(){const i=this.closest(".kanban-board").getAttribute("data-id");l.removeBoard(i)}),p&&p.forEach(i=>{i.classList.add("d-none")}),m&&m.appendChild(u)}),s.addEventListener("hidden.bs.offcanvas",function(){s.querySelector(".ql-editor").firstElementChild.innerHTML=""}),s&&s.addEventListener("shown.bs.offcanvas",function(){[].slice.call(s.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(t){return new bootstrap.Tooltip(t)})})})();
