$(function(){const u=$("#security-logs-table").DataTable({responsive:!0,dom:'<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>><"row"<"col-sm-12"tr>><"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',language:{search:"بحث:",lengthMenu:"عرض _MENU_ سجل",info:"عرض _START_ إلى _END_ من _TOTAL_ سجل",infoEmpty:"لا توجد سجلات متاحة",infoFiltered:"(تمت التصفية من _MAX_ سجل)",paginate:{first:"الأول",last:"الأخير",next:"التالي",previous:"السابق"}},order:[[1,"desc"]]}),s=$("#select-all-logs"),r=$(".log-checkbox"),c=$("#bulk-delete-btn");function i(){const e=$(".log-checkbox:checked").length;e>0?c.removeClass("d-none").html(`<i class="ri-delete-bin-line me-1"></i> حذف المحدد (${e})`):c.addClass("d-none")}$("#toggle-select-all-btn").on("click",function(){const e=s.prop("checked");s.prop("checked",!e),r.prop("checked",!e),i()}),s.on("change",function(){const e=$(this).prop("checked");r.prop("checked",e),i()}),$(document).on("change",".log-checkbox",function(){i();const e=$(".log-checkbox:checked").length===$(".log-checkbox").length;s.prop("checked",e)}),c.on("click",function(){const e=[];$(".log-checkbox:checked").each(function(){e.push($(this).val())}),e.length!==0?Swal.fire({title:"تأكيد الحذف",text:`هل أنت متأكد من حذف ${e.length} سجل؟`,icon:"warning",showCancelButton:!0,confirmButtonText:"نعم، احذف",cancelButtonText:"إلغاء",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"}).then(t=>{t.isConfirmed&&$.ajax({url:$("#bulk-destroy-form").attr("action"),method:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content"),ids:e.join(",")},beforeSend:function(){c.prop("disabled",!0).html('<i class="fas fa-spinner fa-spin"></i> جاري الحذف...')},success:function(o){o.success?Swal.fire({title:"تم الحذف!",text:o.message,icon:"success",confirmButtonText:"حسناً"}).then(()=>{window.location.reload()}):Swal.fire({title:"خطأ!",text:o.message,icon:"error",confirmButtonText:"حسناً"})},error:function(o){const n=o.responseJSON?o.responseJSON.message:"حدث خطأ أثناء حذف السجلات";Swal.fire({title:"خطأ!",text:n,icon:"error",confirmButtonText:"حسناً"})},complete:function(){c.prop("disabled",!1).html('<i class="ri-delete-bin-line me-1"></i> حذف المحدد')}})}):Swal.fire({title:"تنبيه",text:"الرجاء تحديد السجلات التي تريد حذفها",icon:"warning",confirmButtonText:"حسناً"})}),$(".delete-log").on("click",function(e){e.preventDefault();const t=$(this).data("id");Swal.fire({title:"تأكيد الحذف",text:"هل أنت متأكد من حذف هذا السجل؟",icon:"warning",showCancelButton:!0,confirmButtonText:"نعم، احذف",cancelButtonText:"إلغاء",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"}).then(o=>{o.isConfirmed&&$.ajax({url:`/dashboard/security/logs/${t}`,method:"DELETE",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(n){n.success&&Swal.fire({title:"تم الحذف!",text:n.message,icon:"success",confirmButtonText:"حسناً"}).then(()=>{window.location.reload()})},error:function(n){const d=n.responseJSON?n.responseJSON.message:"حدث خطأ أثناء الحذف";Swal.fire({title:"خطأ!",text:d,icon:"error",confirmButtonText:"حسناً"})}})})});let a,l=null;$(".resolve-log").on("click",function(e){e.preventDefault(),l=$(this).data("id"),$("#resolveLogModal").modal("show")}),$("#submitResolveLog").on("click",function(){const e=$("#resolution_notes").val();e?$.ajax({url:`/dashboard/security/logs/${l}/resolve`,method:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content"),resolution_notes:e},success:function(t){$("#resolveLogModal").modal("hide"),t.success&&Swal.fire({title:"تم!",text:t.message,icon:"success",confirmButtonText:"حسناً"}).then(()=>{window.location.reload()})},error:function(t){const o=t.responseJSON?t.responseJSON.message:"حدث خطأ أثناء تحديث السجل";Swal.fire({title:"خطأ!",text:o,icon:"error",confirmButtonText:"حسناً"})}}):Swal.fire({title:"تنبيه",text:"الرجاء إدخال ملاحظات الحل",icon:"warning",confirmButtonText:"حسناً"})}),$("#resolveLogModal").on("hidden.bs.modal",function(){$("#resolution_notes").val(""),l=null}),$(window).on("resize",function(){clearTimeout(a),a=setTimeout(function(){u.columns.adjust().responsive.recalc()},250)})});
