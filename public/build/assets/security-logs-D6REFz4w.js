$(function(){const i=$("#select-all-logs"),n=$(".log-checkbox"),m=$("#bulk-delete-btn"),u=$("#toggle-select-all-btn");let c=!1;function s(){const e=$('input[name="selected_logs[]"]:checked');$("#bulk-delete-btn").toggleClass("d-none",e.length===0)}function r(e){$("#toggle-select-all-btn").html(e?'<i class="ri-checkbox-multiple-blank-line me-1"></i> إلغاء تحديد الكل':'<i class="ri-checkbox-multiple-line me-1"></i> تحديد الكل')}console.log("Loaded: selectAllCheckbox:",i.length),console.log("Loaded: logCheckboxes:",n.length),u.on("click",function(){c=!c,console.log("Toggle Select All:",c),n.prop("checked",c),i.prop("checked",c),s(),r()}),i.on("change",function(){console.log("Select All Checkbox Changed:",$(this).is(":checked")),n.prop("checked",$(this).is(":checked")),s()}),n.on("change",function(){const e=n.length===n.filter(":checked").length;console.log("Individual Checkbox Changed, All Checked:",e),i.prop("checked",e),s()}),$("#toggle-select-all-btn").on("click",function(){const e=$('input[name="selected_logs[]"]'),l=$("#select-all-logs"),t=l.prop("checked");e.prop("checked",!t),l.prop("checked",!t),s(),r(!t)}),$(document).on("change",'input[name="selected_logs[]"]',function(){s()}),$("#bulk-delete-btn").on("click",function(){const e=[];if($('input[name="selected_logs[]"]:checked').each(function(){e.push($(this).val())}),e.length===0)return void alert("الرجاء تحديد السجلات التي تريد حذفها");if(!confirm("هل أنت متأكد من حذف السجلات المحددة؟"))return;const l=$("#form-feedback");l.removeClass("d-none alert-danger alert-success"),$("#bulk-destroy-ids").val(e.join(",")),$.ajax({url:$("#bulk-destroy-form").attr("action"),method:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content"),ids:e.join(",")},beforeSend:function(){$("#bulk-delete-btn").prop("disabled",!0).html('<i class="fas fa-spinner fa-spin"></i> جاري الحذف...')},success:function(t){t.success?(l.addClass("alert alert-success").html(t.message).removeClass("d-none"),setTimeout(()=>{window.location.reload()},1500)):l.addClass("alert alert-danger").html(t.message).removeClass("d-none")},error:function(t){const o=t.responseJSON?t.responseJSON.message:"حدث خطأ أثناء حذف السجلات";l.addClass("alert alert-danger").html(o).removeClass("d-none")},complete:function(){$("#bulk-delete-btn").prop("disabled",!1).html('<i class="fas fa-trash"></i> حذف المحدد')}})}),document.getElementById("toggle-select-all-btn").addEventListener("click",function(){const e=document.querySelectorAll('input[name="selected_logs[]"]'),l=document.getElementById("select-all-logs"),t=l.checked;e.forEach(a=>{a.checked=!t}),l.checked=!t;const o=document.getElementById("bulk-delete-btn"),d=Array.from(e).some(a=>a.checked);o.classList.toggle("d-none",!d)}),document.addEventListener("change",function(e){if(e.target.matches('input[name="selected_logs[]"]')){const l=document.querySelectorAll('input[name="selected_logs[]"]'),t=document.getElementById("bulk-delete-btn"),o=Array.from(l).some(d=>d.checked);t.classList.toggle("d-none",!o)}}),window.submitBulkDelete=function(){const e=[];if(document.querySelectorAll('input[name="selected_logs[]"]:checked').forEach(t=>{e.push(t.value)}),console.log("Selected IDs:",e),e.length===0)return alert("الرجاء تحديد السجلات التي تريد حذفها"),!1;if(!confirm("هل أنت متأكد من حذف السجلات المحددة؟"))return!1;const l=e.join(",");return console.log("IDs string to be sent:",l),document.getElementById("bulk-destroy-ids").value=l,console.log("Form data before submit:",new FormData(document.getElementById("bulk-destroy-form"))),document.getElementById("bulk-destroy-form").submit(),!0},$(".export-excel").on("click",function(e){e.preventDefault();const l={event_type:$("#event-type-filter").val(),status:$("#status-filter").val(),date_from:$("#date-from").val(),date_to:$("#date-to").val()},t=[];Object.entries(l).forEach(([d,a])=>{a&&t.push(`${d}=${encodeURIComponent(a)}`)});const o=t.length>0?`${window.exportUrl}?${t.join("&")}`:window.exportUrl;window.location.href=o}),$(".resolve-form").on("submit",function(e){e.preventDefault();const l=$(this);$.ajax({url:l.attr("action"),method:"POST",data:l.serialize(),success:function(t){l.closest("td").html('<span class="badge bg-label-success">تم الحل</span>'),t.message},error:function(t){console.error("Error:",t),alert("حدث خطأ أثناء تحديث حالة السجل")}})})});
