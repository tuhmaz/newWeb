$(function(){const u=$("#security-logs-table").DataTable({responsive:!0,dom:'<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>><"row"<"col-sm-12"tr>><"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',language:{search:"بحث:",lengthMenu:"عرض _MENU_ سجل",info:"عرض _START_ إلى _END_ من _TOTAL_ سجل",infoEmpty:"لا توجد سجلات متاحة",infoFiltered:"(تمت التصفية من _MAX_ سجل)",paginate:{first:"الأول",last:"الأخير",next:"التالي",previous:"السابق"}},order:[[1,"desc"]]}),s=$("#select-all-logs"),r=$(".log-checkbox"),n=$("#bulk-delete-btn"),d=$("#toggle-select-all-btn");let c=!1;function l(){const e=$(".log-checkbox:checked"),t=$(".log-checkbox").length;n.toggleClass("d-none",e.length===0),s.prop("checked",e.length===t),e.length>0&&n.html(`<i class="ri-delete-bin-line me-1"></i> حذف المحدد (${e.length})`)}d.on("click",function(){c=!c,r.prop("checked",c),l(),$(this).html(c?'<i class="ri-checkbox-multiple-blank-line me-1"></i> إلغاء تحديد الكل':'<i class="ri-checkbox-multiple-line me-1"></i> تحديد الكل')}),s.on("change",function(){r.prop("checked",$(this).is(":checked")),l()}),$(document).on("change",".log-checkbox",function(){l()}),$("#bulk-delete-btn").on("click",function(){const e=[];$(".log-checkbox:checked").each(function(){e.push($(this).val())}),e.length!==0?Swal.fire({title:"تأكيد الحذف",text:`هل أنت متأكد من حذف ${e.length} سجل؟`,icon:"warning",showCancelButton:!0,confirmButtonText:"نعم، احذف",cancelButtonText:"إلغاء",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"}).then(t=>{t.isConfirmed&&($("#form-feedback").removeClass("d-none alert-danger alert-success"),$("#bulk-destroy-ids").val(e.join(",")),$.ajax({url:$("#bulk-destroy-form").attr("action"),method:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content"),ids:e.join(",")},beforeSend:function(){n.prop("disabled",!0).html('<i class="fas fa-spinner fa-spin"></i> جاري الحذف...')},success:function(o){o.success?Swal.fire({title:"تم الحذف!",text:o.message,icon:"success",confirmButtonText:"حسناً"}).then(()=>{window.location.reload()}):Swal.fire({title:"خطأ!",text:o.message,icon:"error",confirmButtonText:"حسناً"})},error:function(o){const f=o.responseJSON?o.responseJSON.message:"حدث خطأ أثناء حذف السجلات";Swal.fire({title:"خطأ!",text:f,icon:"error",confirmButtonText:"حسناً"})},complete:function(){n.prop("disabled",!1).html('<i class="fas fa-trash"></i> حذف المحدد')}}))}):Swal.fire({title:"تنبيه",text:"الرجاء تحديد السجلات التي تريد حذفها",icon:"warning",confirmButtonText:"حسناً"})}),$(".delete-log").on("click",function(e){e.preventDefault();const t=$(this).data("id");Swal.fire({title:"تأكيد الحذف",text:"هل أنت متأكد من حذف هذا السجل؟",icon:"warning",showCancelButton:!0,confirmButtonText:"نعم، احذف",cancelButtonText:"إلغاء",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"}).then(o=>{o.isConfirmed&&(window.location.href=`/dashboard/security/logs/${t}`)})});let a,i=null;$(".resolve-log").on("click",function(e){e.preventDefault(),i=$(this).data("id"),$("#resolveLogModal").modal("show")}),$("#submitResolveLog").on("click",function(){const e=$("#resolution_notes").val();e?$.ajax({url:`/dashboard/security/logs/${i}/resolve`,method:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content"),resolution_notes:e},success:function(t){$("#resolveLogModal").modal("hide"),t.success&&Swal.fire({title:"تم!",text:t.message,icon:"success",confirmButtonText:"حسناً"}).then(()=>{window.location.reload()})},error:function(t){const o=t.responseJSON?t.responseJSON.message:"حدث خطأ أثناء تحديث السجل";Swal.fire({title:"خطأ!",text:o,icon:"error",confirmButtonText:"حسناً"})}}):Swal.fire({title:"تنبيه",text:"الرجاء إدخال ملاحظات الحل",icon:"warning",confirmButtonText:"حسناً"})}),$("#resolveLogModal").on("hidden.bs.modal",function(){$("#resolution_notes").val(""),i=null}),$(window).on("resize",function(){clearTimeout(a),a=setTimeout(function(){u.columns.adjust().responsive.recalc()},250)})});
